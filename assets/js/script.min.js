function Game(){}function Player(e,t){this.name=e,this.role=t,this.shootCounter=0,this.fleet={fourGrid:{weight:4,quantity:1,name:"Четырехпалубник",coords:[]},threeGrid:{weight:3,quantity:2,name:"Трехпалубник",coords:[]},twoGrid:{weight:2,quantity:3,name:"Двухпалубник",coords:[]},oneGrid:{weight:1,quantity:4,name:"Однопалубник",coords:[]}},this.seaCoords=[],this.enemyGrids=[],this.x=10,this.y=10,this.getName=function(){return this.name},this.getRole=function(){return this.role},this.getShootCounter=function(){return this.shootCounter},this.setShootCounter=function(){this.shootCounter++},this.getFleet=function(){return this.fleet},this.getX=function(){return this.x},this.getY=function(){return this.y},this.getSeaCoords=function(){return this.seaCoords},this.addSeaCoords=function(e){this.seaCoords.push(e)},this.removeSeaCoords=function(e){this.seaCoords.splice(e,1)},this.getEnemyGrids=function(){return this.enemyGrids},this.addEnemyGrids=function(e){this.enemyGrids.push(e)},this.removeEnemyGrids=function(e){this.enemyGrids.splice(e,1)},this.initPlayer=function(){this.createGameField(),this.locateFleet()},this.createGameField=function(){for(var e=this.getX(),t=this.getY(),r=1;e>=r;r++)for(var n=1;t>=n;n++)document.getElementById("gamefield_"+this.getRole()).innerHTML+='<span class="seagrid" id="'+r+":"+n+"_"+this.getRole()+'"></span>',this.addSeaCoords(r+":"+n),"comp"===this.getRole()&&this.addEnemyGrids(r+":"+n)},this.locateFleet=function(){function e(){var e=[],n=!1;do{var i=t(),s=r(i);n=o(s)}while(n===!1);return n===!0&&e.push(s[0],s[1]),e}function t(){var e=Math.floor(2*Math.random()),t=Math.floor(Math.random()*(c.getSeaCoords().length-1+1)),r=c.getSeaCoords()[t];return[r,e]}function r(e){for(var t=[],r=n(e),o=e[0].split(":"),i=parseInt(o[0]),s=parseInt(o[1]),a=e[1],u=0;u<h.weight;u++)switch(a){case 1:var c=i,l=s+u;t.push(c+":"+l);break;case 0:var c=i+u,l=s;t.push(c+":"+l)}return[t,r]}function n(e){for(var t=[],r=e[0].split(":"),n=parseInt(r[0]),o=parseInt(r[1]),i=e[1],s=0;s<h.weight;s++)switch(i){case 1:n>1&&t.push(n-1+":"+(o+s)),10>n&&t.push(n+1+":"+(o+s)),0==s&&n>=1&&o>1&&(t.push(n+":"+(o-1)),n>1&&t.push(n-1+":"+(o-1)),10>n&&t.push(n+1+":"+(o-1))),s===h.weight-1&&10-s>o&&(t.push(n+":"+(o+s+1)),n>1&&t.push(n-1+":"+(o+s+1)),10>n&&t.push(n+1+":"+(o+s+1)));break;case 0:o>1&&t.push(n+s+":"+(o-1)),10>o&&t.push(n+s+":"+(o+1)),0===s&&n>1&&o>=1&&(t.push(n-1+":"+o),o>1&&t.push(n-1+":"+(o-1)),10>o&&t.push(n-1+":"+(o+1))),s===h.weight-1&&10-s>n&&(t.push(n+s+1+":"+o),o>1&&t.push(n+s+1+":"+(o-1)),10>o&&t.push(n+s+1+":"+(o+1)))}return t}function o(e){var t,r,n=!1,o=[],i=[];for(var s in e[0]){var a=c.getSeaCoords().indexOf(e[0][s]),u=d.indexOf(e[0][s]);o.push(a),i.push(u)}var h=function(e){return-1==e};return t=o.some(h),r=i.some(h),n=t===!1&&r===!0?!0:!1}function i(e){var t=e[0],r=e[1];s(t,r)}function s(){for(var e in arguments)for(var t in arguments[e]){var r=c.getSeaCoords(),n=r.indexOf(arguments[e][t]);-1!==n&&c.removeSeaCoords(n)}}function a(e){for(var t in e){var r=e[t]+"_"+c.getRole();document.getElementById(r).setAttribute("class","sheep")}}var u,h,c=this,l=c.getFleet(),d=[];for(u in l){h=l[u];for(var m=0;m<h.quantity;m++){var f=e();h.coords.push(f[0]);for(var g in f[1]){var y=d.indexOf(f[1][g]);-1===y&&d.push(f[1][g])}i(f),"user"===c.getRole()&&a(f[0])}}}}Game.prototype={constructor:Game,players:[],getPlayers:function(){return this.players},setPlayers:function(e,t){for(var r in arguments)this.players.push(arguments[r])},getPlayerByRole:function(e){var t=this.getPlayers();for(var r in t)if(t[r].role===e)return t[r]},startGame:function(){this.initPlayers(),this.initShooter()},initPlayers:function(){this.setPlayers(new Player("Пользователь","user"),new Player("Компьютер","comp"));var e=this.getPlayers();for(var t in e){var r=e[t];r.initPlayer()}},initShooter:function(){function e(){var e=this.getAttribute("id"),r=e.indexOf("_"),n=e.substring(0,r);t(n,"user")}function t(t,n){var i,a,u,h=s.getPlayerByRole(n),c=t+"_";"user"===n?(i=s.getPlayerByRole("comp"),c+="comp"):(i=s.getPlayerByRole("user"),c+="user"),a=i.getFleet(),h.setShootCounter(),u=h.getName()+". Выстрел №"+h.getShootCounter()+". ";var l=0;e:for(var d in a){var m=a[d].coords;for(var f in m){var g=m[f].indexOf(t);if(-1!==g){document.getElementById(c).setAttribute("class","killed"),document.getElementById(c).removeEventListener("click",e),1===m[f].length?document.getElementById("countShoot").innerHTML+="<p>"+u+a[d].name+" убит!</p>":document.getElementById("countShoot").innerHTML+="<p>"+u+a[d].name+" ранен!</p>",m[f].splice(g,1);for(var d in a){var m=a[d].coords;for(var f in m)l+=m[f].length}return 0===l&&o(h),"comp"===n&&r("intelligent"),!0}}}document.getElementById("countShoot").innerHTML+="<p>"+u+"Промах!</p>",document.getElementById(c).setAttribute("class","disabled"),document.getElementById(c).removeEventListener("click",e),"user"===n&&r()}function r(e){var r=n(e);t(r,"comp")}function n(){var e,t,r=s.getPlayerByRole("comp").getEnemyGrids();return e=Math.floor(Math.random()*(r.length-1+1)),t=r[e],s.getPlayerByRole("comp").removeEnemyGrids(e),t}function o(e){return document.getElementById("body").setAttribute("style","visibility:hidden;"),alert("Игра окончена! Выйграл "+e.getName()+" за "+e.getShootCounter()+" выстрелов!"),!1}for(var i=document.getElementById("gamefield_comp").getElementsByTagName("span"),s=this,a=0;a<i.length;a++)i[a].addEventListener("click",e)}},function(){var e=new Game;e.startGame()}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdhbWUuQ2xhc3MuanMiLCJQbGF5ZXIuQ2xhc3MuanMiLCJhcHAuanMiXSwibmFtZXMiOlsiR2FtZSIsIlBsYXllciIsIm5hbWUiLCJyb2xlIiwidGhpcyIsInNob290Q291bnRlciIsImZsZWV0IiwiZm91ckdyaWQiLCJ3ZWlnaHQiLCJxdWFudGl0eSIsImNvb3JkcyIsInRocmVlR3JpZCIsInR3b0dyaWQiLCJvbmVHcmlkIiwic2VhQ29vcmRzIiwiZW5lbXlHcmlkcyIsIngiLCJ5IiwiZ2V0TmFtZSIsImdldFJvbGUiLCJnZXRTaG9vdENvdW50ZXIiLCJzZXRTaG9vdENvdW50ZXIiLCJnZXRGbGVldCIsImdldFgiLCJnZXRZIiwiZ2V0U2VhQ29vcmRzIiwiYWRkU2VhQ29vcmRzIiwiaSIsInB1c2giLCJyZW1vdmVTZWFDb29yZHMiLCJzcGxpY2UiLCJnZXRFbmVteUdyaWRzIiwiYWRkRW5lbXlHcmlkcyIsInJlbW92ZUVuZW15R3JpZHMiLCJpbml0UGxheWVyIiwiY3JlYXRlR2FtZUZpZWxkIiwibG9jYXRlRmxlZXQiLCJ4U2l6ZSIsInlTaXplIiwiaiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJnZW5lcmF0ZUNvb3JkcyIsInJlc3VsdCIsInZhbGlkYXRlUG9zaXRpb24iLCJjcmVhdGVkUG9zaXRpb24iLCJjcmVhdGVTdGFydFBvc2l0aW9uIiwidGVtcENvb3JkcyIsImNyZWF0ZUNvb3JkcyIsImNoZWNrQ29vcmRzIiwiZGlyZWN0aW9uIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicG9zSW5kZXgiLCIkc2VsZiIsImxlbmd0aCIsInBvc2l0aW9uIiwic3RhcnREYXRhIiwidGVtcFNoaXBDb29yZHMiLCJ0ZW1wQnVzeUNvb3JkcyIsImNyZWF0ZUJ1c3lDb29yZHMiLCJzdGFydEFyciIsInNwbGl0IiwieFBvcyIsInBhcnNlSW50IiwieVBvcyIsImRpciIsInMiLCJvYmoiLCJ0ZW1wRGVhZENvb3JkcyIsImRhdGEiLCJ2YWxpZF9zaGlwIiwidmFsaWRfYXJvdW5kIiwidmFsaWRhdG9yIiwidGVzdFNoaXBEb3RzIiwidGVzdEJ1c3lEb3RzIiwiayIsImNvb3JkIiwiaW5kZXhPZiIsImJ1c3lEb3QiLCJidXN5Q29vcmRzQXJyYXkiLCJpc192YWxpZCIsIm4iLCJzb21lIiwiY2xlYW5TZWFDb29yZHMiLCJzaGlwQ29vcmRzIiwiYnVzeUNvb3JkcyIsImRlbGV0ZXIiLCJtIiwiYXJndW1lbnRzIiwiY29vcmRzQXJyYXkiLCJkb3QiLCJkcmF3RmxlZXQiLCJrZXkiLCJncmlkSWQiLCJzZXRBdHRyaWJ1dGUiLCJ0IiwidHJpZ2dlciIsInByb3RvdHlwZSIsImNvbnN0cnVjdG9yIiwicGxheWVycyIsImdldFBsYXllcnMiLCJzZXRQbGF5ZXJzIiwicGxheWVyMSIsInBsYXllcjIiLCJnZXRQbGF5ZXJCeVJvbGUiLCJzdGFydEdhbWUiLCJpbml0UGxheWVycyIsImluaXRTaG9vdGVyIiwicGxheWVyIiwiaGFuZGxlU2hvb3QiLCJnZXRBdHRyaWJ1dGUiLCJpbmRleCIsInN1YnN0cmluZyIsImFueWxpc2VIaXQiLCJnYW1lciIsImVuZW15T2JqIiwiZW5lbXlGbGVldCIsImxvZ2dlclN0ciIsImdhbWVyT2JqIiwic2VhR3JpZCIsImNoZWNrZXIiLCJvdXRlciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJmaW5pc2hHYW1lIiwiY29tcFNob290ZXIiLCJwYXJhbSIsImNvbXBIaXRDb29yZCIsImdldEhpdENvb3JkIiwicmVzSW5kZXgiLCJhbGVydCIsImdyaWRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2FtZSJdLCJtYXBwaW5ncyI6IkFBQUEsUUFBQUEsU0NBQSxRQUFBQyxRQUFBQyxFQUFBQyxHQUVBQyxLQUFBRixLQUFBQSxFQUVBRSxLQUFBRCxLQUFBQSxFQUVBQyxLQUFBQyxhQUFBLEVBRUFELEtBQUFFLE9BQ0FDLFVBQ0FDLE9BQUEsRUFDQUMsU0FBQSxFQUNBUCxLQUFBLGtCQUNBUSxX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QUFBaEYsTUFFQSxLQUFBLEdBQUEwRSxLQUFBMUUsR0FDQWlILEdBQUFqSCxFQUFBMEUsR0FBQTNCLE9BWUEsTUFSQSxLQUFBa0UsR0FDQUcsRUFBQUwsR0FHQSxTQUFBSixHQUVBVSxFQUFBLGdCQUVBLElBTUF2RixTQUFBQyxlQUFBLGNBQUFDLFdBQUEsTUFBQThFLEVBQUEsY0FDQWhGLFNBQUFDLGVBQUFpRixHQUFBekIsYUFBQSxRQUFBLFlBQ0F6RCxTQUFBQyxlQUFBaUYsR0FBQUcsb0JBQUEsUUFBQWIsR0FFQSxTQUFBSyxHQUNBVSxJQUlBLFFBQUFBLEdBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsRUFBQUYsRUFDQVosR0FBQWEsRUFBQSxRQUdBLFFBQUFDLEtBQ0EsR0FDQUMsR0FDQXZGLEVBRkE3QixFQUFBeUMsRUFBQW1ELGdCQUFBLFFBQUE1RSxlQVNBLE9BTEFvRyxHQUFBL0UsS0FBQUMsTUFBQUQsS0FBQUUsVUFBQXZDLEVBQUEwQyxPQUFBLEVBQUEsSUFDQWIsRUFBQTdCLEVBQUFvSCxHQUVBM0UsRUFBQW1ELGdCQUFBLFFBQUExRSxpQkFBQWtHLEdBRUF2RixFQUdBLFFBQUFrRixHQUFBVCxHQUdBLE1BRkE3RSxVQUFBQyxlQUFBLFFBQUF3RCxhQUFBLFFBQUEsc0JBQ0FtQyxNQUFBLDBCQUFBZixFQUFBbkcsVUFBQSxPQUFBbUcsRUFBQWpHLGtCQUFBLGdCQUNBLEVBckhBLElBQUEsR0FMQWlILEdBQUE3RixTQUFBQyxlQUFBLGtCQUFBNkYscUJBQUEsUUFDQTlFLEVBQUFwRCxLQUlBOEYsRUFBQSxFQUFBQSxFQUFBbUMsRUFBQTVFLE9BQUF5QyxJQUNBbUMsRUFBQW5DLEdBQUFxQyxpQkFBQSxRQUFBdkIsS0VsREEsV0FFQSxHQUFBd0IsR0FBQSxHQUFBeEksS0FFQXdJLEdBQUE1QiIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gR2FtZSgpIHt9XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gICAgY29uc3RydWN0b3I6IEdhbWUsXG5cbiAgICBwbGF5ZXJzOiBbXSxcblxuICAgIGdldFBsYXllcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXJzO1xuICAgIH0sXG5cbiAgICBzZXRQbGF5ZXJzOiBmdW5jdGlvbihwbGF5ZXIxLCBwbGF5ZXIyKSB7XG4gICAgICAgIGZvciAodmFyIGsgaW4gYXJndW1lbnRzKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllcnMucHVzaChhcmd1bWVudHNba10pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFBsYXllckJ5Um9sZTogZnVuY3Rpb24ocm9sZSkge1xuICAgICAgICB2YXIgcGxheWVycyA9IHRoaXMuZ2V0UGxheWVycygpO1xuICAgICAgICBmb3IgKHZhciBrIGluIHBsYXllcnMpIHtcbiAgICAgICAgICAgIGlmKHBsYXllcnNba10ucm9sZSA9PT0gcm9sZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXJzW2tdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHN0YXJ0R2FtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaW5pdFBsYXllcnMoKTtcbiAgICAgICAgdGhpcy5pbml0U2hvb3RlcigpO1xuICAgIH0sXG5cbiAgICBpbml0UGxheWVyczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNldFBsYXllcnMobmV3IFBsYXllcihcItCf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjFwiLCBcInVzZXJcIiksIG5ldyBQbGF5ZXIoXCLQmtC+0LzQv9GM0Y7RgtC10YBcIiwgXCJjb21wXCIpKTtcblxuICAgICAgICB2YXIgcGxheWVycyA9IHRoaXMuZ2V0UGxheWVycygpO1xuXG4gICAgICAgIGZvciAodmFyIGsgaW4gcGxheWVycykge1xuICAgICAgICAgICAgdmFyIHBsYXllciA9IHBsYXllcnNba107XG4gICAgICAgICAgICBwbGF5ZXIuaW5pdFBsYXllcigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGluaXRTaG9vdGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBncmlkcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lZmllbGRfY29tcCcpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGFuJyksXG4gICAgICAgICAgICAkc2VsZiA9IHRoaXMsXG4gICAgICAgICAgICAvL1RPRE8gSW50ZWxsaWdlbnQgY29tcCBzaG9vdGluZ1xuICAgICAgICAgICAgaW50ZWxsaWdlbnRIaXQ7XG5cbiAgICAgICAgZm9yKHZhciB0PTA7IHQgPCBncmlkcy5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgZ3JpZHNbdF0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZVNob290KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVNob290KCkge1xuICAgICAgICAgICAgdmFyIGdyaWRJZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCdpZCcpLFxuICAgICAgICAgICAgICAgIGluZGV4ID0gZ3JpZElkLmluZGV4T2YoJ18nKSxcbiAgICAgICAgICAgICAgICBjb29yZCA9IGdyaWRJZC5zdWJzdHJpbmcoMCwgaW5kZXgpO1xuXG4gICAgICAgICAgICBhbnlsaXNlSGl0KGNvb3JkLCAndXNlcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYW55bGlzZUhpdChjb29yZCwgZ2FtZXIpIHtcbiAgICAgICAgICAgIHZhciBnYW1lck9iaiA9ICRzZWxmLmdldFBsYXllckJ5Um9sZShnYW1lciksXG4gICAgICAgICAgICAgICAgZW5lbXlPYmosXG4gICAgICAgICAgICAgICAgZW5lbXlGbGVldCxcbiAgICAgICAgICAgICAgICBzZWFHcmlkID0gY29vcmQgKyAnXycsXG4gICAgICAgICAgICAgICAgbG9nZ2VyU3RyO1xuXG4gICAgICAgICAgICBpZiAoZ2FtZXIgPT09ICd1c2VyJykge1xuICAgICAgICAgICAgICAgIGVuZW15T2JqID0gJHNlbGYuZ2V0UGxheWVyQnlSb2xlKCdjb21wJyk7XG4gICAgICAgICAgICAgICAgc2VhR3JpZCArPSAnY29tcCc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVuZW15T2JqID0gJHNlbGYuZ2V0UGxheWVyQnlSb2xlKCd1c2VyJyk7XG4gICAgICAgICAgICAgICAgc2VhR3JpZCArPSAndXNlcic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVuZW15RmxlZXQgPSBlbmVteU9iai5nZXRGbGVldCgpO1xuXG4gICAgICAgICAgICBnYW1lck9iai5zZXRTaG9vdENvdW50ZXIoKTtcblxuICAgICAgICAgICAgbG9nZ2VyU3RyID0gZ2FtZXJPYmouZ2V0TmFtZSgpXG4gICAgICAgICAgICAgICAgK1wiLiBcIlxuICAgICAgICAgICAgICAgICtcItCS0YvRgdGC0YDQtdC7IOKEllwiXG4gICAgICAgICAgICAgICAgK2dhbWVyT2JqLmdldFNob290Q291bnRlcigpXG4gICAgICAgICAgICAgICAgK1wiLiBcIjtcblxuICAgICAgICAgICAgdmFyIGNoZWNrZXIgPSAwO1xuXG4gICAgICAgICAgICBvdXRlcjpcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBtIGluIGVuZW15RmxlZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkcyA9IGVuZW15RmxlZXRbbV0uY29vcmRzO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gaW4gY29vcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlciA9IGNvb3Jkc1tuXS5pbmRleE9mKGNvb3JkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyICE9PSAtMSkgeyAvLyBpZiBjb21wIHNoaXAgaXMgaGl0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VhR3JpZCkuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJraWxsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VhR3JpZCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZVNob290KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb29yZHNbbl0ubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY291bnRTaG9vdFwiKS5pbm5lckhUTUwrPVwiPHA+XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICtsb2dnZXJTdHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICtlbmVteUZsZWV0W21dLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICtcIiDRg9Cx0LjRgiE8L3A+XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvdW50U2hvb3RcIikuaW5uZXJIVE1MKz1cIjxwPlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArbG9nZ2VyU3RyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArZW5lbXlGbGVldFttXS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArXCIg0YDQsNC90LXQvSE8L3A+XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29yZHNbbl0uc3BsaWNlKHRyaWdnZXIsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbSBpbiBlbmVteUZsZWV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb29yZHMgPSBlbmVteUZsZWV0W21dLmNvb3JkcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBuIGluIGNvb3Jkcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlcis9IGNvb3Jkc1tuXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tlciA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hHYW1lKGdhbWVyT2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZXIgPT09ICdjb21wJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gSW50ZWxsaWdlbnQgY29tcCBzaG9vdGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wU2hvb3RlcignaW50ZWxsaWdlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY291bnRTaG9vdFwiKS5pbm5lckhUTUwrPVwiPHA+XCIgKyBsb2dnZXJTdHIgKyBcItCf0YDQvtC80LDRhSE8L3A+XCI7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWFHcmlkKS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VhR3JpZCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZVNob290KTtcblxuICAgICAgICAgICAgaWYgKGdhbWVyID09PSAndXNlcicpIHtcbiAgICAgICAgICAgICAgICBjb21wU2hvb3RlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY29tcFNob290ZXIocGFyYW0pIHtcbiAgICAgICAgICAgIHZhciBjb21wSGl0Q29vcmQgPSBnZXRIaXRDb29yZChwYXJhbSk7XG4gICAgICAgICAgICBhbnlsaXNlSGl0KGNvbXBIaXRDb29yZCwgJ2NvbXAnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEhpdENvb3JkKCkge1xuICAgICAgICAgICAgdmFyIGVuZW15R3JpZHMgPSAkc2VsZi5nZXRQbGF5ZXJCeVJvbGUoJ2NvbXAnKS5nZXRFbmVteUdyaWRzKCksXG4gICAgICAgICAgICAgICAgcmVzSW5kZXgsXG4gICAgICAgICAgICAgICAgcmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgcmVzSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKGVuZW15R3JpZHMubGVuZ3RoLTEpICsgMSkpOyAvLyBhcnJheSBpbmRleFxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGVuZW15R3JpZHNbcmVzSW5kZXhdO1xuXG4gICAgICAgICAgICAkc2VsZi5nZXRQbGF5ZXJCeVJvbGUoJ2NvbXAnKS5yZW1vdmVFbmVteUdyaWRzKHJlc0luZGV4KTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmlzaEdhbWUoZ2FtZXIpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib2R5Jykuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJ2aXNpYmlsaXR5OmhpZGRlbjtcIik7XG4gICAgICAgICAgICBhbGVydChcItCY0LPRgNCwINC+0LrQvtC90YfQtdC90LAhINCS0YvQudCz0YDQsNC7IFwiK2dhbWVyLmdldE5hbWUoKStcIiDQt9CwIFwiK2dhbWVyLmdldFNob290Q291bnRlcigpK1wiINCy0YvRgdGC0YDQtdC70L7QsiFcIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgIH1cbn07IiwiZnVuY3Rpb24gUGxheWVyIChuYW1lLCByb2xlKSB7XG5cbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuXG4gICAgdGhpcy5yb2xlID0gcm9sZTtcblxuICAgIHRoaXMuc2hvb3RDb3VudGVyID0gMDtcblxuICAgIHRoaXMuZmxlZXQgPSB7XG4gICAgICAgIGZvdXJHcmlkOiB7XG4gICAgICAgICAgICB3ZWlnaHQ6NCxcbiAgICAgICAgICAgIHF1YW50aXR5OjEsXG4gICAgICAgICAgICBuYW1lOiBcItCn0LXRgtGL0YDQtdGF0L/QsNC70YPQsdC90LjQulwiLFxuICAgICAgICAgICAgY29vcmRzOiBbXVxuICAgICAgICB9LFxuICAgICAgICB0aHJlZUdyaWQ6IHtcbiAgICAgICAgICAgIHdlaWdodDogMyxcbiAgICAgICAgICAgIHF1YW50aXR5OiAyLFxuICAgICAgICAgICAgbmFtZTogXCLQotGA0LXRhdC/0LDQu9GD0LHQvdC40LpcIixcbiAgICAgICAgICAgIGNvb3JkczogW11cbiAgICAgICAgfSxcbiAgICAgICAgdHdvR3JpZDoge1xuICAgICAgICAgICAgd2VpZ2h0OiAyLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDMsXG4gICAgICAgICAgICBuYW1lOiBcItCU0LLRg9GF0L/QsNC70YPQsdC90LjQulwiLFxuICAgICAgICAgICAgY29vcmRzOiBbXVxuICAgICAgICB9LFxuICAgICAgICBvbmVHcmlkOiB7XG4gICAgICAgICAgICB3ZWlnaHQ6IDEsXG4gICAgICAgICAgICBxdWFudGl0eTogNCxcbiAgICAgICAgICAgIG5hbWU6IFwi0J7QtNC90L7Qv9Cw0LvRg9Cx0L3QuNC6XCIsXG4gICAgICAgICAgICBjb29yZHM6IFtdXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5zZWFDb29yZHMgPSBbXTtcblxuICAgIHRoaXMuZW5lbXlHcmlkcyA9IFtdO1xuXG4gICAgdGhpcy54ID0gMTA7XG5cbiAgICB0aGlzLnkgPSAxMDtcblxuICAgIHRoaXMuZ2V0TmFtZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xuICAgIH07XG5cbiAgICB0aGlzLmdldFJvbGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9sZTtcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRTaG9vdENvdW50ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvb3RDb3VudGVyO1xuICAgIH07XG5cbiAgICB0aGlzLnNldFNob290Q291bnRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNob290Q291bnRlcisrO1xuICAgIH07XG5cbiAgICB0aGlzLmdldEZsZWV0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZsZWV0O1xuICAgIH07XG5cbiAgICB0aGlzLmdldFggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMueDtcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRZID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnk7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0U2VhQ29vcmRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWFDb29yZHM7XG4gICAgfTtcblxuICAgIHRoaXMuYWRkU2VhQ29vcmRzID0gZnVuY3Rpb24oaSkge1xuICAgICAgICB0aGlzLnNlYUNvb3Jkcy5wdXNoKGkpO1xuICAgIH07XG5cbiAgICB0aGlzLnJlbW92ZVNlYUNvb3JkcyA9IGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgdGhpcy5zZWFDb29yZHMuc3BsaWNlKGksMSk7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0RW5lbXlHcmlkcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbmVteUdyaWRzO1xuICAgIH07XG5cbiAgICB0aGlzLmFkZEVuZW15R3JpZHMgPSBmdW5jdGlvbihpKSB7XG4gICAgICAgIHRoaXMuZW5lbXlHcmlkcy5wdXNoKGkpO1xuICAgIH07XG5cbiAgICB0aGlzLnJlbW92ZUVuZW15R3JpZHMgPSBmdW5jdGlvbihpKSB7XG4gICAgICAgIHRoaXMuZW5lbXlHcmlkcy5zcGxpY2UoaSwxKTtcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0UGxheWVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlR2FtZUZpZWxkKCk7XG4gICAgICAgIHRoaXMubG9jYXRlRmxlZXQoKTtcbiAgICB9O1xuXG4gICAgdGhpcy5jcmVhdGVHYW1lRmllbGQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgIHZhciB4U2l6ZSA9IHRoaXMuZ2V0WCgpLFxuICAgICAgICAgICAgIHlTaXplID0gdGhpcy5nZXRZKCk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0geFNpemU7IGkrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDE7IGogPD0geVNpemU7IGorKykge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lZmllbGRfJyArIHRoaXMuZ2V0Um9sZSgpKS5pbm5lckhUTUwgKz0gJzxzcGFuIGNsYXNzPVwic2VhZ3JpZFwiIGlkPVwiJysgaSArICc6JysgaiArIFwiX1wiICsgdGhpcy5nZXRSb2xlKCkrJ1wiPjwvc3Bhbj4nO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VhQ29vcmRzKGkrXCI6XCIraik7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRSb2xlKCkgPT09ICdjb21wJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEVuZW15R3JpZHMoaStcIjpcIitqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2NhdGVGbGVldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJHNlbGYgPSB0aGlzLFxuICAgICAgICAgICAgZmxlZXQgPSAkc2VsZi5nZXRGbGVldCgpLFxuICAgICAgICAgICAgaywgb2JqLFxuICAgICAgICAgICAgYnVzeUNvb3Jkc0FycmF5ID0gW107XG5cbiAgICAgICAgLy8gcnVuIG92ZXIgZmxlZXQgb2JqZWN0XG4gICAgICAgIGZvciAoayBpbiBmbGVldCkge1xuICAgICAgICAgICAgb2JqID0gZmxlZXRba107XG5cbiAgICAgICAgICAgIC8vIHJ1biBvdmVyIHNoaXBzIG9uIGZsZWV0XG4gICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IG9iai5xdWFudGl0eTsgdCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNoaXBDb29yZHMgPSBnZW5lcmF0ZUNvb3JkcygpOyAvLyByZXN1bHQgY29vcmRzIGZvciBzaGlwXG4gICAgICAgICAgICAgICAgb2JqLmNvb3Jkcy5wdXNoKHNoaXBDb29yZHNbMF0pO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbSBpbiBzaGlwQ29vcmRzWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyID0gYnVzeUNvb3Jkc0FycmF5LmluZGV4T2Yoc2hpcENvb3Jkc1sxXVttXSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnVzeUNvb3Jkc0FycmF5LnB1c2goc2hpcENvb3Jkc1sxXVttXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjbGVhblNlYUNvb3JkcyhzaGlwQ29vcmRzKTtcblxuICAgICAgICAgICAgICAgIGlmKCRzZWxmLmdldFJvbGUoKSA9PT0gJ3VzZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGRyYXdGbGVldChzaGlwQ29vcmRzWzBdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBnZW5lcmF0ZSBjb29yZHNcbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVDb29yZHMoKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW10sXG4gICAgICAgICAgICAgICAgdmFsaWRhdGVQb3NpdGlvbiA9IGZhbHNlO1xuXG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIHNoaXAgY29vcmRzIGFuZCBidXN5IGNvb3Jkc1xuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVkUG9zaXRpb24gPSBjcmVhdGVTdGFydFBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgIHRlbXBDb29yZHMgPSBjcmVhdGVDb29yZHMoY3JlYXRlZFBvc2l0aW9uKTtcblxuICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRlIGNvb3JkcyBmb3Igc2hpcCBsb2NhdGlvblxuICAgICAgICAgICAgICAgIHZhbGlkYXRlUG9zaXRpb24gPSBjaGVja0Nvb3Jkcyh0ZW1wQ29vcmRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdoaWxlKHZhbGlkYXRlUG9zaXRpb24gPT09IGZhbHNlKTtcblxuICAgICAgICAgICAgaWYgKHZhbGlkYXRlUG9zaXRpb24gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0ZW1wQ29vcmRzWzBdLCB0ZW1wQ29vcmRzWzFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyByYW5kb21pc2Ugc3RhcnQgcG9zaXRpb25cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlU3RhcnRQb3NpdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSwgLy8gMCAtIGRyYXcgc2hpcCBob3Jpem9udGFsOyAxIC0gZHJhdyBzaGlwIHZlcnRpY2FsXG4gICAgICAgICAgICAgICAgcG9zSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKCRzZWxmLmdldFNlYUNvb3JkcygpLmxlbmd0aC0xKSArIDEpKSwgLy8gYXJyYXkgaW5kZXhcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9ICRzZWxmLmdldFNlYUNvb3JkcygpW3Bvc0luZGV4XTsgLy8gdmFsdWUgb24gdGhpcyBpbmRleFxuXG4gICAgICAgICAgICByZXR1cm4gW3Bvc2l0aW9uLCBkaXJlY3Rpb25dO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2FsY3VsYXRlIHNoaXAgY29vcmRzXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNvb3JkcyhzdGFydERhdGEpIHtcbiAgICAgICAgICAgIHZhciB0ZW1wU2hpcENvb3JkcyA9IFtdLFxuICAgICAgICAgICAgICAgIHRlbXBCdXN5Q29vcmRzID0gY3JlYXRlQnVzeUNvb3JkcyhzdGFydERhdGEpLFxuICAgICAgICAgICAgICAgIHN0YXJ0QXJyID0gc3RhcnREYXRhWzBdLnNwbGl0KFwiOlwiKSxcbiAgICAgICAgICAgICAgICB4UG9zID0gcGFyc2VJbnQoc3RhcnRBcnJbMF0pLFxuICAgICAgICAgICAgICAgIHlQb3MgPSBwYXJzZUludChzdGFydEFyclsxXSksXG4gICAgICAgICAgICAgICAgZGlyID0gc3RhcnREYXRhWzFdO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBzPTA7IHMgPCBvYmoud2VpZ2h0OyBzKyspIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRpcikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHhQb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHlQb3MgKyBzO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wU2hpcENvb3Jkcy5wdXNoKHggKyBcIjpcIiArIHkpOyAvLyB2YWx1ZXMgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHhQb3MgKyBzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB5UG9zO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wU2hpcENvb3Jkcy5wdXNoKHggKyBcIjpcIiArIHkpOyAvLyB2YWx1ZXMgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBbdGVtcFNoaXBDb29yZHMsIHRlbXBCdXN5Q29vcmRzXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1c3lDb29yZHMoaSkge1xuICAgICAgICAgICAgdmFyIHRlbXBEZWFkQ29vcmRzPVtdLFxuICAgICAgICAgICAgICAgIHN0YXJ0QXJyID0gaVswXS5zcGxpdChcIjpcIiksXG4gICAgICAgICAgICAgICAgeCA9IHBhcnNlSW50KHN0YXJ0QXJyWzBdKSxcbiAgICAgICAgICAgICAgICB5ID0gcGFyc2VJbnQoc3RhcnRBcnJbMV0pLFxuICAgICAgICAgICAgICAgIGRpciA9IGlbMV07Ly8gMCAtIGRyYXcgc2hpcCBob3Jpem9udGFsOyAxIC0gZHJhdyBzaGlwIHZlcnRpY2FsXG5cbiAgICAgICAgICAgIGZvciAodmFyIHM9MDsgcyA8IG9iai53ZWlnaHQ7IHMrKykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoZGlyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHg+MSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERlYWRDb29yZHMucHVzaCh4LTErXCI6XCIrKHkrcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoeDwxMCkgdGVtcERlYWRDb29yZHMucHVzaCh4KzErXCI6XCIrKHkrcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocz09MCAmJiB4Pj0xICYmIHk+MSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERlYWRDb29yZHMucHVzaCh4K1wiOlwiKyh5LTEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih4PjEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKHgtMStcIjpcIisoeS0xKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHg8MTApIHRlbXBEZWFkQ29vcmRzLnB1c2goeCsxK1wiOlwiKyh5LTEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHMgPT09IG9iai53ZWlnaHQtMSAmJiB5PDEwLXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEZWFkQ29vcmRzLnB1c2goeCtcIjpcIisoKHkrcykrMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHg+MSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEZWFkQ29vcmRzLnB1c2goKHgtMSkrXCI6XCIrKCh5K3MpKzEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeDwxMCkgdGVtcERlYWRDb29yZHMucHVzaCgoeCsxKStcIjpcIisoKHkrcykrMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoeT4xKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKCh4K3MpK1wiOlwiKyh5LTEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHk8MTApIHRlbXBEZWFkQ29vcmRzLnB1c2goKHgrcykrXCI6XCIrKHkrMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocyA9PT0gMCAmJiB4PjEgJiYgeT49MSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERlYWRDb29yZHMucHVzaCh4LTErXCI6XCIrKHkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih5PjEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKCh4LTEpK1wiOlwiKyh5LTEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeTwxMCkgdGVtcERlYWRDb29yZHMucHVzaCgoeC0xKStcIjpcIisoeSsxKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzID09PSBvYmoud2VpZ2h0LTEgJiYgeDwxMC1zKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKCh4K3MpKzErXCI6XCIrKHkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih5PjEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKCh4K3MpKzErXCI6XCIrKHktMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih5PDEwKXRlbXBEZWFkQ29vcmRzLnB1c2goKHgrcykrMStcIjpcIisoeSsxKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGVtcERlYWRDb29yZHM7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB2YWxpZGF0b3IgZm9yIGNyZWF0ZWQgY29vcmRzXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrQ29vcmRzKGRhdGEpIHtcbiAgICAgICAgICAgIHZhciB2YWxpZGF0b3IgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICB0ZXN0U2hpcERvdHMgPSBbXSxcbiAgICAgICAgICAgICAgICB0ZXN0QnVzeURvdHMgPSBbXSxcbiAgICAgICAgICAgICAgICB2YWxpZF9zaGlwLFxuICAgICAgICAgICAgICAgIHZhbGlkX2Fyb3VuZDtcblxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBkYXRhWzBdKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvb3JkID0gJHNlbGYuZ2V0U2VhQ29vcmRzKCkuaW5kZXhPZihkYXRhWzBdW2tdKSxcbiAgICAgICAgICAgICAgICAgICAgYnVzeURvdCA9IGJ1c3lDb29yZHNBcnJheS5pbmRleE9mKGRhdGFbMF1ba10pOyAvL3ZhbHVlXG5cbiAgICAgICAgICAgICAgICB0ZXN0U2hpcERvdHMucHVzaChjb29yZCk7XG4gICAgICAgICAgICAgICAgdGVzdEJ1c3lEb3RzLnB1c2goYnVzeURvdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpc192YWxpZCA9IGZ1bmN0aW9uKG4pIHsgcmV0dXJuIG4gPT0gLTE7IH07XG5cbiAgICAgICAgICAgIHZhbGlkX3NoaXAgPSB0ZXN0U2hpcERvdHMuc29tZShpc192YWxpZCk7XG4gICAgICAgICAgICB2YWxpZF9hcm91bmQgPSB0ZXN0QnVzeURvdHMuc29tZShpc192YWxpZCk7XG5cbiAgICAgICAgICAgIGlmICh2YWxpZF9zaGlwID09PSBmYWxzZSAmJiB2YWxpZF9hcm91bmQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0b3IgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0b3IgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGRlbGV0ZSBidXN5IGNvb3JkcyBmcm9tIHNlYUNvb3JkcyBBcnJheVxuICAgICAgICBmdW5jdGlvbiBjbGVhblNlYUNvb3JkcyhkYXRhKSB7XG4gICAgICAgICAgICB2YXIgc2hpcENvb3JkcyA9IGRhdGFbMF0sXG4gICAgICAgICAgICAgICAgYnVzeUNvb3JkcyA9IGRhdGFbMV07XG5cbiAgICAgICAgICAgIGRlbGV0ZXIoc2hpcENvb3JkcyxidXN5Q29vcmRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZXIoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBtIGluIGFyZ3VtZW50cykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgaW4gYXJndW1lbnRzW21dKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb29yZHNBcnJheSA9ICRzZWxmLmdldFNlYUNvb3JkcygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG90ID0gY29vcmRzQXJyYXkuaW5kZXhPZihhcmd1bWVudHNbbV1ba10pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkb3QgIT09IC0xKSAkc2VsZi5yZW1vdmVTZWFDb29yZHMoZG90KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkcmF3IGZsZWV0IG9uIHNlYWZpZWxkXG4gICAgICAgIGZ1bmN0aW9uIGRyYXdGbGVldChpKSB7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGdyaWRJZCA9IGlba2V5XStcIl9cIiskc2VsZi5nZXRSb2xlKCk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZ3JpZElkKS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInNoZWVwXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn0iLCIoZnVuY3Rpb24oKXtcblxuICAgIHZhciBnYW1lID0gbmV3IEdhbWUoKTtcblxuICAgIGdhbWUuc3RhcnRHYW1lKCk7XG5cbn0oKSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
