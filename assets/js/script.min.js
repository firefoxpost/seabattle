function Game(){}function Player(e,t){this.name=e,this.role=t,this.shootCounter=0,this.fleet={fourGrid:{weight:4,quantity:1,name:"Четырехпалубник",coords:[]},threeGrid:{weight:3,quantity:2,name:"Трехпалубник",coords:[]},twoGrid:{weight:2,quantity:3,name:"Двухпалубник",coords:[]},oneGrid:{weight:1,quantity:4,name:"Однопалубник",coords:[]}},this.seaCoords=[],this.enemyGrids=[],this.x=10,this.y=10,this.getName=function(){return this.name},this.getRole=function(){return this.role},this.getShootCounter=function(){return this.shootCounter},this.setShootCounter=function(){this.shootCounter++},this.getFleet=function(){return this.fleet},this.getX=function(){return this.x},this.getY=function(){return this.y},this.getSeaCoords=function(){return this.seaCoords},this.addSeaCoords=function(e){this.seaCoords.push(e)},this.removeSeaCoords=function(e){this.seaCoords.splice(e,1)},this.getEnemyGrids=function(){return this.enemyGrids},this.addEnemyGrids=function(e){this.enemyGrids.push(e)},this.removeEnemyGrids=function(e){this.enemyGrids.splice(e,1)},this.initPlayer=function(){this.createGameField(),this.locateFleet()},this.createGameField=function(){for(var e=this.getX(),t=this.getY(),n=1;e>=n;n++)for(var r=1;t>=r;r++)document.getElementById("gamefield_"+this.getRole()).innerHTML+='<span class="seagrid" id="'+n+":"+r+"_"+this.getRole()+'"></span>',this.addSeaCoords(n+":"+r),"comp"===this.getRole()&&this.addEnemyGrids(n+":"+r)},this.locateFleet=function(){function e(){var e=[],r=!1;do{var i=t(),s=n(i);r=o(s)}while(r===!1);return r===!0&&e.push(s[0],s[1]),e}function t(){var e=Math.floor(2*Math.random()),t=Math.floor(Math.random()*(c.getSeaCoords().length-1+1)),n=c.getSeaCoords()[t];return[n,e]}function n(e){for(var t=[],n=r(e),o=e[0].split(":"),i=parseInt(o[0]),s=parseInt(o[1]),a=e[1],u=0;u<h.weight;u++)switch(a){case 1:var c=i,l=s+u;t.push(c+":"+l);break;case 0:var c=i+u,l=s;t.push(c+":"+l)}return[t,n]}function r(e){for(var t=[],n=e[0].split(":"),r=parseInt(n[0]),o=parseInt(n[1]),i=e[1],s=0;s<h.weight;s++)switch(i){case 1:r>1&&t.push(r-1+":"+(o+s)),10>r&&t.push(r+1+":"+(o+s)),0==s&&r>=1&&o>1&&(t.push(r+":"+(o-1)),r>1&&t.push(r-1+":"+(o-1)),10>r&&t.push(r+1+":"+(o-1))),s===h.weight-1&&10-s>o&&(t.push(r+":"+(o+s+1)),r>1&&t.push(r-1+":"+(o+s+1)),10>r&&t.push(r+1+":"+(o+s+1)));break;case 0:o>1&&t.push(r+s+":"+(o-1)),10>o&&t.push(r+s+":"+(o+1)),0===s&&r>1&&o>=1&&(t.push(r-1+":"+o),o>1&&t.push(r-1+":"+(o-1)),10>o&&t.push(r-1+":"+(o+1))),s===h.weight-1&&10-s>r&&(t.push(r+s+1+":"+o),o>1&&t.push(r+s+1+":"+(o-1)),10>o&&t.push(r+s+1+":"+(o+1)))}return t}function o(e){var t,n,r=!1,o=[],i=[];for(var s in e[0]){var a=c.getSeaCoords().indexOf(e[0][s]),u=d.indexOf(e[0][s]);o.push(a),i.push(u)}var h=function(e){return-1==e};return t=o.some(h),n=i.some(h),r=t===!1&&n===!0?!0:!1}function i(e){var t=e[0],n=e[1];s(t,n)}function s(){for(var e in arguments)for(var t in arguments[e]){var n=c.getSeaCoords(),r=n.indexOf(arguments[e][t]);-1!==r&&c.removeSeaCoords(r)}}function a(e){for(var t in e){var n=e[t]+"_"+c.getRole();document.getElementById(n).setAttribute("class","sheep")}}var u,h,c=this,l=c.getFleet(),d=[];for(u in l){h=l[u];for(var m=0;m<h.quantity;m++){var f=e();h.coords.push(f[0]);for(var g in f[1]){var y=d.indexOf(f[1][g]);-1===y&&d.push(f[1][g])}i(f),"user"===c.getRole()&&a(f[0])}}}}Game.prototype={constructor:Game,players:[],getPlayers:function(){return this.players},setPlayers:function(e,t){for(var n in arguments)this.players.push(arguments[n])},getPlayerByRole:function(e){var t=this.getPlayers();for(var n in t)if(t[n].role===e)return t[n]},startGame:function(){this.initPlayers(),this.initShooter()},initPlayers:function(){this.setPlayers(new Player("Пользователь","user"),new Player("Компьютер","comp"));var e=this.getPlayers();for(var t in e){var n=e[t];n.initPlayer()}},initShooter:function(){function e(){var e=this.getAttribute("id"),n=e.indexOf("_"),r=e.substring(0,n);t(r,"user")}function t(t,o){var s,a,h,c=u.getPlayerByRole(o),l=t+"_";"user"===o?(s=u.getPlayerByRole("comp"),l+="comp"):(s=u.getPlayerByRole("user"),l+="user"),a=s.getFleet(),c.setShootCounter(),h=c.getName()+". Выстрел №"+c.getShootCounter()+". ";var d=0;e:for(var m in a){var f=a[m].coords;for(var g in f){var y=f[g].indexOf(t);if(-1!==y){document.getElementById(l).setAttribute("class","killed"),document.getElementById(l).removeEventListener("click",e),1===f[g].length?document.getElementById("countShoot").innerHTML+="<p>"+h+a[m].name+" убит!</p>":document.getElementById("countShoot").innerHTML+="<p>"+h+a[m].name+" ранен!</p>",r(),f[g].splice(y,1);for(var m in a){var f=a[m].coords;for(var g in f)d+=f[g].length}return 0===d&&i(c),"comp"===o&&n("intelligent"),!0}}}document.getElementById("countShoot").innerHTML+="<p>"+h+"Промах!</p>",document.getElementById(l).setAttribute("class","disabled"),document.getElementById(l).removeEventListener("click",e),r(),"user"===o&&n()}function n(e){var n=o(e);t(n,"comp")}function r(){var e=document.getElementById("countShoot");e.scrollTop=e.scrollHeight}function o(){var e,t,n=u.getPlayerByRole("comp").getEnemyGrids();return e=Math.floor(Math.random()*(n.length-1+1)),t=n[e],u.getPlayerByRole("comp").removeEnemyGrids(e),t}function i(e){document.getElementById("body").setAttribute("style","visibility:hidden;"),alert("Игра окончена! Выйграл "+e.getName()+" за "+e.getShootCounter()+" выстрелов!"),document.getElementById("reloadGame").setAttribute("style","display:inline-block"),document.getElementById("reloadGame").addEventListener("click",s)}function s(){location.reload()}for(var a=document.getElementById("gamefield_comp").getElementsByTagName("span"),u=this,h=0;h<a.length;h++)a[h].addEventListener("click",e)}},function(){var e=new Game;e.startGame()}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdhbWUuQ2xhc3MuanMiLCJQbGF5ZXIuQ2xhc3MuanMiLCJhcHAuanMiXSwibmFtZXMiOlsiR2FtZSIsIlBsYXllciIsIm5hbWUiLCJyb2xlIiwidGhpcyIsInNob290Q291bnRlciIsImZsZWV0IiwiZm91ckdyaWQiLCJ3ZWlnaHQiLCJxdWFudGl0eSIsImNvb3JkcyIsInRocmVlR3JpZCIsInR3b0dyaWQiLCJvbmVHcmlkIiwic2VhQ29vcmRzIiwiZW5lbXlHcmlkcyIsIngiLCJ5IiwiZ2V0TmFtZSIsImdldFJvbGUiLCJnZXRTaG9vdENvdW50ZXIiLCJzZXRTaG9vdENvdW50ZXIiLCJnZXRGbGVldCIsImdldFgiLCJnZXRZIiwiZ2V0U2VhQ29vcmRzIiwiYWRkU2VhQ29vcmRzIiwiaSIsInB1c2giLCJyZW1vdmVTZWFDb29yZHMiLCJzcGxpY2UiLCJnZXRFbmVteUdyaWRzIiwiYWRkRW5lbXlHcmlkcyIsInJlbW92ZUVuZW15R3JpZHMiLCJpbml0UGxheWVyIiwiY3JlYXRlR2FtZUZpZWxkIiwibG9jYXRlRmxlZXQiLCJ4U2l6ZSIsInlTaXplIiwiaiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJnZW5lcmF0ZUNvb3JkcyIsInJlc3VsdCIsInZhbGlkYXRlUG9zaXRpb24iLCJjcmVhdGVkUG9zaXRpb24iLCJjcmVhdGVTdGFydFBvc2l0aW9uIiwidGVtcENvb3JkcyIsImNyZWF0ZUNvb3JkcyIsImNoZWNrQ29vcmRzIiwiZGlyZWN0aW9uIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicG9zSW5kZXgiLCIkc2VsZiIsImxlbmd0aCIsInBvc2l0aW9uIiwic3RhcnREYXRhIiwidGVtcFNoaXBDb29yZHMiLCJ0ZW1wQnVzeUNvb3JkcyIsImNyZWF0ZUJ1c3lDb29yZHMiLCJzdGFydEFyciIsInNwbGl0IiwieFBvcyIsInBhcnNlSW50IiwieVBvcyIsImRpciIsInMiLCJvYmoiLCJ0ZW1wRGVhZENvb3JkcyIsImRhdGEiLCJ2YWxpZF9zaGlwIiwidmFsaWRfYXJvdW5kIiwidmFsaWRhdG9yIiwidGVzdFNoaXBEb3RzIiwidGVzdEJ1c3lEb3RzIiwiayIsImNvb3JkIiwiaW5kZXhPZiIsImJ1c3lEb3QiLCJidXN5Q29vcmRzQXJyYXkiLCJpc192YWxpZCIsIm4iLCJzb21lIiwiY2xlYW5TZWFDb29yZHMiLCJzaGlwQ29vcmRzIiwiYnVzeUNvb3JkcyIsImRlbGV0ZXIiLCJtIiwiYXJndW1lbnRzIiwiY29vcmRzQXJyYXkiLCJkb3QiLCJkcmF3RmxlZXQiLCJrZXkiLCJncmlkSWQiLCJzZXRBdHRyaWJ1dGUiLCJ0IiwidHJpZ2dlciIsInByb3RvdHlwZSIsImNvbnN0cnVjdG9yIiwicGxheWVycyIsImdldFBsYXllcnMiLCJzZXRQbGF5ZXJzIiwicGxheWVyMSIsInBsYXllcjIiLCJnZXRQbGF5ZXJCeVJvbGUiLCJzdGFydEdhbWUiLCJpbml0UGxheWVycyIsImluaXRTaG9vdGVyIiwicGxheWVyIiwiaGFuZGxlU2hvb3QiLCJnZXRBdHRyaWJ1dGUiLCJpbmRleCIsInN1YnN0cmluZyIsImFueWxpc2VIaXQiLCJnYW1lciIsImVuZW15T2JqIiwiZW5lbXlGbGVldCIsImxvZ2dlclN0ciIsImdhbWVyT2JqIiwic2VhR3JpZCIsImNoZWNrZXIiLCJvdXRlciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzY3JvbGxMb2dnZXIiLCJmaW5pc2hHYW1lIiwiY29tcFNob290ZXIiLCJwYXJhbSIsImNvbXBIaXRDb29yZCIsImdldEhpdENvb3JkIiwib2JqRGl2Iiwic2Nyb2xsVG9wIiwic2Nyb2xsSGVpZ2h0IiwicmVzSW5kZXgiLCJhbGVydCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZWxvYWRlciIsImxvY2F0aW9uIiwicmVsb2FkIiwiZ3JpZHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdhbWUiXSwibWFwcGluZ3MiOiJBQUFBLFFBQUFBLFNDQUEsUUFBQUMsUUFBQUMsRUFBQUMsR0FFQUMsS0FBQUYsS0FBQUEsRUFFQUUsS0FBQUQsS0FBQUEsRUFFQUMsS0FBQUMsYUFBQSxFQUVBRCxLQUFBRSxPQUNBQyxVQUNBQyxPQUFBLEVBQ0FDLFNBQUEsRUFDQVAsS0FBQSxrQkFDQVEsV0FFQUMsV0FDQUgsT0FBQSxFQUNBQyxTQUFBLEVBQ0FQLEtBQUEsZUFDQVEsV0FFQUUsU0FDQUosT0FBQSxFQUNBQyxTQUFBLEVBQ0FQLEtBQUEsZUFDQVEsV0FFQUcsU0FDQUwsT0FBQSxFQUNBQyxTQUFBLEVBQ0FQLEtBQUEsZUFDQVEsWUFJQU4sS0FBQVUsYUFFQVYsS0FBQVcsY0FFQVgsS0FBQVksRUFBQSxHQUVBWixLQUFBYSxFQUFBLEdBRUFiLEtBQUFjLFFBQUEsV0FDQSxNQUFBZCxNQUFBRixNQUdBRSxLQUFBZSxRQUFBLFdBQ0EsTUFBQWYsTUFBQUQsTUFHQUMsS0FBQWdCLGdCQUFBLFdBQ0EsTUFBQWhCLE1BQUFDLGNBR0FELEtBQUFpQixnQkFBQSxXQUNBakIsS0FBQUMsZ0JBR0FELEtBQUFrQixTQUFBLFdBQ0EsTUFBQWxCLE1BQUFFLE9BR0FGLEtBQUFtQixLQUFBLFdBQ0EsTUFBQW5CLE1BQUFZLEdBR0FaLEtBQUFvQixLQUFBLFdBQ0EsTUFBQXBCLE1BQUFhLEdBR0FiLEtBQUFxQixhQUFBLFdBQ0EsTUFBQXJCLE1BQUFVLFdBR0FWLEtBQUFzQixhQUFBLFNBQUFDLEdBQ0F2QixLQUFBVSxVQUFBYyxLQUFBRCxJQUdBdkIsS0FBQXlCLGdCQUFBLFNBQUFGLEdBQ0F2QixLQUFBVSxVQUFBZ0IsT0FBQUgsRUFBQSxJQUdBdkIsS0FBQTJCLGNBQUEsV0FDQSxNQUFBM0IsTUFBQVcsWUFHQVgsS0FBQTRCLGNBQUEsU0FBQUwsR0FDQXZCLEtBQUFXLFdBQUFhLEtBQUFELElBR0F2QixLQUFBNkIsaUJBQUEsU0FBQU4sR0FDQXZCLEtBQUFXLFdBQUFlLE9BQUFILEVBQUEsSUFHQXZCLEtBQUE4QixXQUFBLFdBQ0E5QixLQUFBK0Isa0JBQ0EvQixLQUFBZ0MsZUFHQWhDLEtBQUErQixnQkFBQSxXQUlBLElBQUEsR0FIQUUsR0FBQWpDLEtBQUFtQixPQUNBZSxFQUFBbEMsS0FBQW9CLE9BRUFHLEVBQUEsRUFBQVUsR0FBQVYsRUFBQUEsSUFDQSxJQUFBLEdBQUFZLEdBQUEsRUFBQUQsR0FBQUMsRUFBQUEsSUFDQUMsU0FBQUMsZUFBQSxhQUFBckMsS0FBQWUsV0FBQXVCLFdBQUEsNkJBQUFmLEVBQUEsSUFBQVksRUFBQSxJQUFBbkMsS0FBQWUsVUFBQSxZQUNBZixLQUFBc0IsYUFBQUMsRUFBQSxJQUFBWSxHQUVBLFNBQUFuQyxLQUFBZSxXQUNBZixLQUFBNEIsY0FBQUwsRUFBQSxJQUFBWSxJQU1BbkMsS0FBQWdDLFlBQUEsV0ErQkEsUUFBQU8sS0FDQSxHQUFBQyxNQUNBQyxHQUFBLENBRUEsR0FBQSxDQUVBLEdBQUFDLEdBQUFDLElBQ0FDLEVBQUFDLEVBQUFILEVBR0FELEdBQUFLLEVBQUFGLFNBRUFILEtBQUEsRUFLQSxPQUhBQSxNQUFBLEdBQ0FELEVBQUFoQixLQUFBb0IsRUFBQSxHQUFBQSxFQUFBLElBRUFKLEVBSUEsUUFBQUcsS0FDQSxHQUFBSSxHQUFBQyxLQUFBQyxNQUFBLEVBQUFELEtBQUFFLFVBQ0FDLEVBQUFILEtBQUFDLE1BQUFELEtBQUFFLFVBQUFFLEVBQUEvQixlQUFBZ0MsT0FBQSxFQUFBLElBQ0FDLEVBQUFGLEVBQUEvQixlQUFBOEIsRUFFQSxRQUFBRyxFQUFBUCxHQUlBLFFBQUFGLEdBQUFVLEdBUUEsSUFBQSxHQVBBQyxNQUNBQyxFQUFBQyxFQUFBSCxHQUNBSSxFQUFBSixFQUFBLEdBQUFLLE1BQUEsS0FDQUMsRUFBQUMsU0FBQUgsRUFBQSxJQUNBSSxFQUFBRCxTQUFBSCxFQUFBLElBQ0FLLEVBQUFULEVBQUEsR0FFQVUsRUFBQSxFQUFBQSxFQUFBQyxFQUFBOUQsT0FBQTZELElBQ0EsT0FBQUQsR0FDQSxJQUFBLEdBQ0EsR0FBQXBELEdBQUFpRCxFQUNBaEQsRUFBQWtELEVBQUFFLENBRUFULEdBQUFoQyxLQUFBWixFQUFBLElBQUFDLEVBQ0EsTUFDQSxLQUFBLEdBQ0EsR0FBQUQsR0FBQWlELEVBQUFJLEVBQ0FwRCxFQUFBa0QsQ0FFQVAsR0FBQWhDLEtBQUFaLEVBQUEsSUFBQUMsR0FJQSxPQUFBMkMsRUFBQUMsR0FHQSxRQUFBQyxHQUFBbkMsR0FPQSxJQUFBLEdBTkE0QyxNQUNBUixFQUFBcEMsRUFBQSxHQUFBcUMsTUFBQSxLQUNBaEQsRUFBQWtELFNBQUFILEVBQUEsSUFDQTlDLEVBQUFpRCxTQUFBSCxFQUFBLElBQ0FLLEVBQUF6QyxFQUFBLEdBRUEwQyxFQUFBLEVBQUFBLEVBQUFDLEVBQUE5RCxPQUFBNkQsSUFDQSxPQUFBRCxHQUNBLElBQUEsR0FDQXBELEVBQUEsR0FDQXVELEVBQUEzQyxLQUFBWixFQUFBLEVBQUEsS0FBQUMsRUFBQW9ELElBRUEsR0FBQXJELEdBQUF1RCxFQUFBM0MsS0FBQVosRUFBQSxFQUFBLEtBQUFDLEVBQUFvRCxJQUNBLEdBQUFBLEdBQUFyRCxHQUFBLEdBQUFDLEVBQUEsSUFDQXNELEVBQUEzQyxLQUFBWixFQUFBLEtBQUFDLEVBQUEsSUFDQUQsRUFBQSxHQUNBdUQsRUFBQTNDLEtBQUFaLEVBQUEsRUFBQSxLQUFBQyxFQUFBLElBRUEsR0FBQUQsR0FBQXVELEVBQUEzQyxLQUFBWixFQUFBLEVBQUEsS0FBQUMsRUFBQSxLQUVBb0QsSUFBQUMsRUFBQTlELE9BQUEsR0FBQSxHQUFBNkQsRUFBQXBELElBQ0FzRCxFQUFBM0MsS0FBQVosRUFBQSxLQUFBQyxFQUFBb0QsRUFBQSxJQUNBckQsRUFBQSxHQUNBdUQsRUFBQTNDLEtBQUFaLEVBQUEsRUFBQSxLQUFBQyxFQUFBb0QsRUFBQSxJQUVBLEdBQUFyRCxHQUFBdUQsRUFBQTNDLEtBQUFaLEVBQUEsRUFBQSxLQUFBQyxFQUFBb0QsRUFBQSxJQUVBLE1BRUEsS0FBQSxHQUNBcEQsRUFBQSxHQUNBc0QsRUFBQTNDLEtBQUFaLEVBQUFxRCxFQUFBLEtBQUFwRCxFQUFBLElBRUEsR0FBQUEsR0FBQXNELEVBQUEzQyxLQUFBWixFQUFBcUQsRUFBQSxLQUFBcEQsRUFBQSxJQUNBLElBQUFvRCxHQUFBckQsRUFBQSxHQUFBQyxHQUFBLElBQ0FzRCxFQUFBM0MsS0FBQVosRUFBQSxFQUFBLElBQUEsR0FDQUMsRUFBQSxHQUNBc0QsRUFBQTNDLEtBQUFaLEVBQUEsRUFBQSxLQUFBQyxFQUFBLElBRUEsR0FBQUEsR0FBQXNELEVBQUEzQyxLQUFBWixFQUFBLEVBQUEsS0FBQUMsRUFBQSxLQUVBb0QsSUFBQUMsRUFBQTlELE9BQUEsR0FBQSxHQUFBNkQsRUFBQXJELElBQ0F1RCxFQUFBM0MsS0FBQVosRUFBQXFELEVBQUEsRUFBQSxJQUFBLEdBQ0FwRCxFQUFBLEdBQ0FzRCxFQUFBM0MsS0FBQVosRUFBQXFELEVBQUEsRUFBQSxLQUFBcEQsRUFBQSxJQUVBLEdBQUFBLEdBQUFzRCxFQUFBM0MsS0FBQVosRUFBQXFELEVBQUEsRUFBQSxLQUFBcEQsRUFBQSxLQUtBLE1BQUFzRCxHQUlBLFFBQUFyQixHQUFBc0IsR0FDQSxHQUdBQyxHQUNBQyxFQUpBQyxHQUFBLEVBQ0FDLEtBQ0FDLElBSUEsS0FBQSxHQUFBQyxLQUFBTixHQUFBLEdBQUEsQ0FDQSxHQUFBTyxHQUFBdkIsRUFBQS9CLGVBQUF1RCxRQUFBUixFQUFBLEdBQUFNLElBQ0FHLEVBQUFDLEVBQUFGLFFBQUFSLEVBQUEsR0FBQU0sR0FFQUYsR0FBQWhELEtBQUFtRCxHQUNBRixFQUFBakQsS0FBQXFELEdBR0EsR0FBQUUsR0FBQSxTQUFBQyxHQUFBLE1BQUEsSUFBQUEsRUFXQSxPQVRBWCxHQUFBRyxFQUFBUyxLQUFBRixHQUNBVCxFQUFBRyxFQUFBUSxLQUFBRixHQUdBUixFQURBRixLQUFBLEdBQUFDLEtBQUEsR0FDQSxHQUVBLEVBT0EsUUFBQVksR0FBQWQsR0FDQSxHQUFBZSxHQUFBZixFQUFBLEdBQ0FnQixFQUFBaEIsRUFBQSxFQUVBaUIsR0FBQUYsRUFBQUMsR0FHQSxRQUFBQyxLQUNBLElBQUEsR0FBQUMsS0FBQUMsV0FDQSxJQUFBLEdBQUFiLEtBQUFhLFdBQUFELEdBQUEsQ0FDQSxHQUFBRSxHQUFBcEMsRUFBQS9CLGVBQ0FvRSxFQUFBRCxFQUFBWixRQUFBVyxVQUFBRCxHQUFBWixHQUVBLE1BQUFlLEdBQUFyQyxFQUFBM0IsZ0JBQUFnRSxJQU1BLFFBQUFDLEdBQUFuRSxHQUVBLElBQUEsR0FBQW9FLEtBQUFwRSxHQUFBLENBQ0EsR0FBQXFFLEdBQUFyRSxFQUFBb0UsR0FBQSxJQUFBdkMsRUFBQXJDLFNBQ0FxQixVQUFBQyxlQUFBdUQsR0FBQUMsYUFBQSxRQUFBLFVBcE1BLEdBRUFuQixHQUFBUixFQUZBZCxFQUFBcEQsS0FDQUUsRUFBQWtELEVBQUFsQyxXQUVBNEQsSUFHQSxLQUFBSixJQUFBeEUsR0FBQSxDQUNBZ0UsRUFBQWhFLEVBQUF3RSxFQUdBLEtBQUEsR0FBQW9CLEdBQUEsRUFBQUEsRUFBQTVCLEVBQUE3RCxTQUFBeUYsSUFBQSxDQUNBLEdBQUFYLEdBQUE1QyxHQUNBMkIsR0FBQTVELE9BQUFrQixLQUFBMkQsRUFBQSxHQUVBLEtBQUEsR0FBQUcsS0FBQUgsR0FBQSxHQUFBLENBQ0EsR0FBQVksR0FBQWpCLEVBQUFGLFFBQUFPLEVBQUEsR0FBQUcsR0FDQSxNQUFBUyxHQUNBakIsRUFBQXRELEtBQUEyRCxFQUFBLEdBQUFHLElBSUFKLEVBQUFDLEdBRUEsU0FBQS9CLEVBQUFyQyxXQUNBMkUsRUFBQVAsRUFBQSxPRDNJQXZGLEtBQUFvRyxXQUVBQyxZQUFBckcsS0FFQXNHLFdBRUFDLFdBQUEsV0FDQSxNQUFBbkcsTUFBQWtHLFNBR0FFLFdBQUEsU0FBQUMsRUFBQUMsR0FDQSxJQUFBLEdBQUE1QixLQUFBYSxXQUNBdkYsS0FBQWtHLFFBQUExRSxLQUFBK0QsVUFBQWIsS0FJQTZCLGdCQUFBLFNBQUF4RyxHQUNBLEdBQUFtRyxHQUFBbEcsS0FBQW1HLFlBQ0EsS0FBQSxHQUFBekIsS0FBQXdCLEdBQ0EsR0FBQUEsRUFBQXhCLEdBQUEzRSxPQUFBQSxFQUNBLE1BQUFtRyxHQUFBeEIsSUFLQThCLFVBQUEsV0FDQXhHLEtBQUF5RyxjQUNBekcsS0FBQTBHLGVBR0FELFlBQUEsV0FDQXpHLEtBQUFvRyxXQUFBLEdBQUF2RyxRQUFBLGVBQUEsUUFBQSxHQUFBQSxRQUFBLFlBQUEsUUFFQSxJQUFBcUcsR0FBQWxHLEtBQUFtRyxZQUVBLEtBQUEsR0FBQXpCLEtBQUF3QixHQUFBLENBQ0EsR0FBQVMsR0FBQVQsRUFBQXhCLEVBQ0FpQyxHQUFBN0UsZUFJQTRFLFlBQUEsV0FVQSxRQUFBRSxLQUNBLEdBQUFoQixHQUFBNUYsS0FBQTZHLGFBQUEsTUFDQUMsRUFBQWxCLEVBQUFoQixRQUFBLEtBQ0FELEVBQUFpQixFQUFBbUIsVUFBQSxFQUFBRCxFQUVBRSxHQUFBckMsRUFBQSxRQUdBLFFBQUFxQyxHQUFBckMsRUFBQXNDLEdBQ0EsR0FDQUMsR0FDQUMsRUFFQUMsRUFKQUMsRUFBQWpFLEVBQUFtRCxnQkFBQVUsR0FHQUssRUFBQTNDLEVBQUEsR0FHQSxVQUFBc0MsR0FDQUMsRUFBQTlELEVBQUFtRCxnQkFBQSxRQUNBZSxHQUFBLFNBRUFKLEVBQUE5RCxFQUFBbUQsZ0JBQUEsUUFDQWUsR0FBQSxRQUdBSCxFQUFBRCxFQUFBaEcsV0FFQW1HLEVBQUFwRyxrQkFFQW1HLEVBQUFDLEVBQUF2RyxVQUNBLGNBRUF1RyxFQUFBckcsa0JBQ0EsSUFFQSxJQUFBdUcsR0FBQSxDQUVBQyxHQUNBLElBQUEsR0FBQWxDLEtBQUE2QixHQUFBLENBQ0EsR0FBQTdHLEdBQUE2RyxFQUFBN0IsR0FBQWhGLE1BRUEsS0FBQSxHQUFBMEUsS0FBQTFFLEdBQUEsQ0FDQSxHQUFBeUYsR0FBQXpGLEVBQUEwRSxHQUFBSixRQUFBRCxFQUNBLElBQUEsS0FBQW9CLEVBQUEsQ0FDQTNELFNBQUFDLGVBQUFpRixHQUFBekIsYUFBQSxRQUFBLFVBQ0F6RCxTQUFBQyxlQUFBaUYsR0FBQUcsb0JBQUEsUUFBQWIsR0FFQSxJQUFBdEcsRUFBQTBFLEdBQUEzQixPQUNBakIsU0FBQUMsZUFBQSxjQUFBQyxXQUFBLE1BQ0E4RSxFQUNBRCxFQUFBN0IsR0FBQXhGLEtBQ0EsYUFHQXNDLFNBQUFDLGVBQUEsY0FBQUMsV0FBQSxNQUNBOEUsRUFDQUQsRUFBQTdCLEdBQUF4RixLQUNBLGNBSUE0SCxJQUVBcEgsRUFBQTBFLEdBQUF0RCxPQUFBcUUsRUFBQSxFQUVBLEtBQUEsR0FBQVQsS0FBQTZCLEdBQUEsQ0FDQSxHQUFBN0csR0FBQTZHLEVBQUE3QixHQUFBaEYsTUFFQSxLQUFBLEdBQUEwRSxLQUFBMUUsR0FDQWlILEdBQUFqSCxFQUFBMEUsR0FBQTNCLE9BWUEsTUFSQSxLQUFBa0UsR0FDQUksRUFBQU4sR0FHQSxTQUFBSixHQUVBVyxFQUFBLGdCQUVBLElBTUF4RixTQUFBQyxlQUFBLGNBQUFDLFdBQUEsTUFBQThFLEVBQUEsY0FDQWhGLFNBQUFDLGVBQUFpRixHQUFBekIsYUFBQSxRQUFBLFlBQ0F6RCxTQUFBQyxlQUFBaUYsR0FBQUcsb0JBQUEsUUFBQWIsR0FDQWMsSUFFQSxTQUFBVCxHQUNBVyxJQUlBLFFBQUFBLEdBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsRUFBQUYsRUFDQWIsR0FBQWMsRUFBQSxRQUdBLFFBQUFKLEtBQ0EsR0FBQU0sR0FBQTVGLFNBQUFDLGVBQUEsYUFDQTJGLEdBQUFDLFVBQUFELEVBQUFFLGFBR0EsUUFBQUgsS0FDQSxHQUNBSSxHQUNBM0YsRUFGQTdCLEVBQUF5QyxFQUFBbUQsZ0JBQUEsUUFBQTVFLGVBU0EsT0FMQXdHLEdBQUFuRixLQUFBQyxNQUFBRCxLQUFBRSxVQUFBdkMsRUFBQTBDLE9BQUEsRUFBQSxJQUNBYixFQUFBN0IsRUFBQXdILEdBRUEvRSxFQUFBbUQsZ0JBQUEsUUFBQTFFLGlCQUFBc0csR0FFQTNGLEVBR0EsUUFBQW1GLEdBQUFWLEdBQ0E3RSxTQUFBQyxlQUFBLFFBQUF3RCxhQUFBLFFBQUEsc0JBQ0F1QyxNQUFBLDBCQUFBbkIsRUFBQW5HLFVBQUEsT0FBQW1HLEVBQUFqRyxrQkFBQSxlQUNBb0IsU0FBQUMsZUFBQSxjQUFBd0QsYUFBQSxRQUFBLHdCQUNBekQsU0FBQUMsZUFBQSxjQUFBZ0csaUJBQUEsUUFBQUMsR0FHQSxRQUFBQSxLQUNBQyxTQUFBQyxTQWxJQSxJQUFBLEdBTEFDLEdBQUFyRyxTQUFBQyxlQUFBLGtCQUFBcUcscUJBQUEsUUFDQXRGLEVBQUFwRCxLQUlBOEYsRUFBQSxFQUFBQSxFQUFBMkMsRUFBQXBGLE9BQUF5QyxJQUNBMkMsRUFBQTNDLEdBQUF1QyxpQkFBQSxRQUFBekIsS0VsREEsV0FFQSxHQUFBK0IsR0FBQSxHQUFBL0ksS0FFQStJLEdBQUFuQyIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gR2FtZSgpIHt9XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gICAgY29uc3RydWN0b3I6IEdhbWUsXG5cbiAgICBwbGF5ZXJzOiBbXSxcblxuICAgIGdldFBsYXllcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXJzO1xuICAgIH0sXG5cbiAgICBzZXRQbGF5ZXJzOiBmdW5jdGlvbihwbGF5ZXIxLCBwbGF5ZXIyKSB7XG4gICAgICAgIGZvciAodmFyIGsgaW4gYXJndW1lbnRzKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllcnMucHVzaChhcmd1bWVudHNba10pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFBsYXllckJ5Um9sZTogZnVuY3Rpb24ocm9sZSkge1xuICAgICAgICB2YXIgcGxheWVycyA9IHRoaXMuZ2V0UGxheWVycygpO1xuICAgICAgICBmb3IgKHZhciBrIGluIHBsYXllcnMpIHtcbiAgICAgICAgICAgIGlmKHBsYXllcnNba10ucm9sZSA9PT0gcm9sZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXJzW2tdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHN0YXJ0R2FtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaW5pdFBsYXllcnMoKTtcbiAgICAgICAgdGhpcy5pbml0U2hvb3RlcigpO1xuICAgIH0sXG5cbiAgICBpbml0UGxheWVyczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNldFBsYXllcnMobmV3IFBsYXllcihcItCf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjFwiLCBcInVzZXJcIiksIG5ldyBQbGF5ZXIoXCLQmtC+0LzQv9GM0Y7RgtC10YBcIiwgXCJjb21wXCIpKTtcblxuICAgICAgICB2YXIgcGxheWVycyA9IHRoaXMuZ2V0UGxheWVycygpO1xuXG4gICAgICAgIGZvciAodmFyIGsgaW4gcGxheWVycykge1xuICAgICAgICAgICAgdmFyIHBsYXllciA9IHBsYXllcnNba107XG4gICAgICAgICAgICBwbGF5ZXIuaW5pdFBsYXllcigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGluaXRTaG9vdGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBncmlkcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lZmllbGRfY29tcCcpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGFuJyksXG4gICAgICAgICAgICAkc2VsZiA9IHRoaXMsXG4gICAgICAgICAgICAvL1RPRE8gSW50ZWxsaWdlbnQgY29tcCBzaG9vdGluZ1xuICAgICAgICAgICAgaW50ZWxsaWdlbnRIaXQ7XG5cbiAgICAgICAgZm9yKHZhciB0PTA7IHQgPCBncmlkcy5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgZ3JpZHNbdF0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZVNob290KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVNob290KCkge1xuICAgICAgICAgICAgdmFyIGdyaWRJZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCdpZCcpLFxuICAgICAgICAgICAgICAgIGluZGV4ID0gZ3JpZElkLmluZGV4T2YoJ18nKSxcbiAgICAgICAgICAgICAgICBjb29yZCA9IGdyaWRJZC5zdWJzdHJpbmcoMCwgaW5kZXgpO1xuXG4gICAgICAgICAgICBhbnlsaXNlSGl0KGNvb3JkLCAndXNlcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYW55bGlzZUhpdChjb29yZCwgZ2FtZXIpIHtcbiAgICAgICAgICAgIHZhciBnYW1lck9iaiA9ICRzZWxmLmdldFBsYXllckJ5Um9sZShnYW1lciksXG4gICAgICAgICAgICAgICAgZW5lbXlPYmosXG4gICAgICAgICAgICAgICAgZW5lbXlGbGVldCxcbiAgICAgICAgICAgICAgICBzZWFHcmlkID0gY29vcmQgKyAnXycsXG4gICAgICAgICAgICAgICAgbG9nZ2VyU3RyO1xuXG4gICAgICAgICAgICBpZiAoZ2FtZXIgPT09ICd1c2VyJykge1xuICAgICAgICAgICAgICAgIGVuZW15T2JqID0gJHNlbGYuZ2V0UGxheWVyQnlSb2xlKCdjb21wJyk7XG4gICAgICAgICAgICAgICAgc2VhR3JpZCArPSAnY29tcCc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVuZW15T2JqID0gJHNlbGYuZ2V0UGxheWVyQnlSb2xlKCd1c2VyJyk7XG4gICAgICAgICAgICAgICAgc2VhR3JpZCArPSAndXNlcic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVuZW15RmxlZXQgPSBlbmVteU9iai5nZXRGbGVldCgpO1xuXG4gICAgICAgICAgICBnYW1lck9iai5zZXRTaG9vdENvdW50ZXIoKTtcblxuICAgICAgICAgICAgbG9nZ2VyU3RyID0gZ2FtZXJPYmouZ2V0TmFtZSgpXG4gICAgICAgICAgICAgICAgK1wiLiBcIlxuICAgICAgICAgICAgICAgICtcItCS0YvRgdGC0YDQtdC7IOKEllwiXG4gICAgICAgICAgICAgICAgK2dhbWVyT2JqLmdldFNob290Q291bnRlcigpXG4gICAgICAgICAgICAgICAgK1wiLiBcIjtcblxuICAgICAgICAgICAgdmFyIGNoZWNrZXIgPSAwO1xuXG4gICAgICAgICAgICBvdXRlcjpcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBtIGluIGVuZW15RmxlZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkcyA9IGVuZW15RmxlZXRbbV0uY29vcmRzO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gaW4gY29vcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlciA9IGNvb3Jkc1tuXS5pbmRleE9mKGNvb3JkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyICE9PSAtMSkgeyAvLyBpZiBjb21wIHNoaXAgaXMgaGl0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VhR3JpZCkuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJraWxsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VhR3JpZCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZVNob290KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb29yZHNbbl0ubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY291bnRTaG9vdFwiKS5pbm5lckhUTUwrPVwiPHA+XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICtsb2dnZXJTdHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICtlbmVteUZsZWV0W21dLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICtcIiDRg9Cx0LjRgiE8L3A+XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvdW50U2hvb3RcIikuaW5uZXJIVE1MKz1cIjxwPlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArbG9nZ2VyU3RyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArZW5lbXlGbGVldFttXS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArXCIg0YDQsNC90LXQvSE8L3A+XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsTG9nZ2VyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzW25dLnNwbGljZSh0cmlnZ2VyLCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG0gaW4gZW5lbXlGbGVldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29vcmRzID0gZW5lbXlGbGVldFttXS5jb29yZHM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiBpbiBjb29yZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZXIrPSBjb29yZHNbbl0ubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZXIgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoR2FtZShnYW1lck9iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWVyID09PSAnY29tcCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIEludGVsbGlnZW50IGNvbXAgc2hvb3RpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcFNob290ZXIoJ2ludGVsbGlnZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvdW50U2hvb3RcIikuaW5uZXJIVE1MKz1cIjxwPlwiICsgbG9nZ2VyU3RyICsgXCLQn9GA0L7QvNCw0YUhPC9wPlwiO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VhR3JpZCkuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlYUdyaWQpLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVTaG9vdCk7XG4gICAgICAgICAgICBzY3JvbGxMb2dnZXIoKTtcblxuICAgICAgICAgICAgaWYgKGdhbWVyID09PSAndXNlcicpIHtcbiAgICAgICAgICAgICAgICBjb21wU2hvb3RlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY29tcFNob290ZXIocGFyYW0pIHtcbiAgICAgICAgICAgIHZhciBjb21wSGl0Q29vcmQgPSBnZXRIaXRDb29yZChwYXJhbSk7XG4gICAgICAgICAgICBhbnlsaXNlSGl0KGNvbXBIaXRDb29yZCwgJ2NvbXAnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNjcm9sbExvZ2dlcigpIHsgICAgXG4gICAgICAgICAgICB2YXIgb2JqRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb3VudFNob290XCIpO1xuICAgICAgICAgICAgb2JqRGl2LnNjcm9sbFRvcCA9IG9iakRpdi5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRIaXRDb29yZCgpIHtcbiAgICAgICAgICAgIHZhciBlbmVteUdyaWRzID0gJHNlbGYuZ2V0UGxheWVyQnlSb2xlKCdjb21wJykuZ2V0RW5lbXlHcmlkcygpLFxuICAgICAgICAgICAgICAgIHJlc0luZGV4LFxuICAgICAgICAgICAgICAgIHJlc3VsdDtcblxuICAgICAgICAgICAgICAgIHJlc0luZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKChlbmVteUdyaWRzLmxlbmd0aC0xKSArIDEpKTsgLy8gYXJyYXkgaW5kZXhcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBlbmVteUdyaWRzW3Jlc0luZGV4XTtcblxuICAgICAgICAgICAgJHNlbGYuZ2V0UGxheWVyQnlSb2xlKCdjb21wJykucmVtb3ZlRW5lbXlHcmlkcyhyZXNJbmRleCk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5pc2hHYW1lKGdhbWVyKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm9keScpLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwidmlzaWJpbGl0eTpoaWRkZW47XCIpO1xuICAgICAgICAgICAgYWxlcnQoXCLQmNCz0YDQsCDQvtC60L7QvdGH0LXQvdCwISDQktGL0LnQs9GA0LDQuyBcIitnYW1lci5nZXROYW1lKCkrXCIg0LfQsCBcIitnYW1lci5nZXRTaG9vdENvdW50ZXIoKStcIiDQstGL0YHRgtGA0LXQu9C+0LIhXCIpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbG9hZEdhbWUnKS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImRpc3BsYXk6aW5saW5lLWJsb2NrXCIpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbG9hZEdhbWUnKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcmVsb2FkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVsb2FkZXIoKSB7XG4gICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfVxuXG4gICAgfVxufTsiLCJmdW5jdGlvbiBQbGF5ZXIgKG5hbWUsIHJvbGUpIHtcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG5cbiAgICB0aGlzLnJvbGUgPSByb2xlO1xuXG4gICAgdGhpcy5zaG9vdENvdW50ZXIgPSAwO1xuXG4gICAgdGhpcy5mbGVldCA9IHtcbiAgICAgICAgZm91ckdyaWQ6IHtcbiAgICAgICAgICAgIHdlaWdodDo0LFxuICAgICAgICAgICAgcXVhbnRpdHk6MSxcbiAgICAgICAgICAgIG5hbWU6IFwi0KfQtdGC0YvRgNC10YXQv9Cw0LvRg9Cx0L3QuNC6XCIsXG4gICAgICAgICAgICBjb29yZHM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHRocmVlR3JpZDoge1xuICAgICAgICAgICAgd2VpZ2h0OiAzLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDIsXG4gICAgICAgICAgICBuYW1lOiBcItCi0YDQtdGF0L/QsNC70YPQsdC90LjQulwiLFxuICAgICAgICAgICAgY29vcmRzOiBbXVxuICAgICAgICB9LFxuICAgICAgICB0d29HcmlkOiB7XG4gICAgICAgICAgICB3ZWlnaHQ6IDIsXG4gICAgICAgICAgICBxdWFudGl0eTogMyxcbiAgICAgICAgICAgIG5hbWU6IFwi0JTQstGD0YXQv9Cw0LvRg9Cx0L3QuNC6XCIsXG4gICAgICAgICAgICBjb29yZHM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIG9uZUdyaWQ6IHtcbiAgICAgICAgICAgIHdlaWdodDogMSxcbiAgICAgICAgICAgIHF1YW50aXR5OiA0LFxuICAgICAgICAgICAgbmFtZTogXCLQntC00L3QvtC/0LDQu9GD0LHQvdC40LpcIixcbiAgICAgICAgICAgIGNvb3JkczogW11cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnNlYUNvb3JkcyA9IFtdO1xuXG4gICAgdGhpcy5lbmVteUdyaWRzID0gW107XG5cbiAgICB0aGlzLnggPSAxMDtcblxuICAgIHRoaXMueSA9IDEwO1xuXG4gICAgdGhpcy5nZXROYW1lID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5hbWU7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0Um9sZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb2xlO1xuICAgIH07XG5cbiAgICB0aGlzLmdldFNob290Q291bnRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG9vdENvdW50ZXI7XG4gICAgfTtcblxuICAgIHRoaXMuc2V0U2hvb3RDb3VudGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc2hvb3RDb3VudGVyKys7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0RmxlZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmxlZXQ7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0WCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy54O1xuICAgIH07XG5cbiAgICB0aGlzLmdldFkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMueTtcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRTZWFDb29yZHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlYUNvb3JkcztcbiAgICB9O1xuXG4gICAgdGhpcy5hZGRTZWFDb29yZHMgPSBmdW5jdGlvbihpKSB7XG4gICAgICAgIHRoaXMuc2VhQ29vcmRzLnB1c2goaSk7XG4gICAgfTtcblxuICAgIHRoaXMucmVtb3ZlU2VhQ29vcmRzID0gZnVuY3Rpb24oaSkge1xuICAgICAgICB0aGlzLnNlYUNvb3Jkcy5zcGxpY2UoaSwxKTtcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRFbmVteUdyaWRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVuZW15R3JpZHM7XG4gICAgfTtcblxuICAgIHRoaXMuYWRkRW5lbXlHcmlkcyA9IGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgdGhpcy5lbmVteUdyaWRzLnB1c2goaSk7XG4gICAgfTtcblxuICAgIHRoaXMucmVtb3ZlRW5lbXlHcmlkcyA9IGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgdGhpcy5lbmVteUdyaWRzLnNwbGljZShpLDEpO1xuICAgIH07XG5cbiAgICB0aGlzLmluaXRQbGF5ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVHYW1lRmllbGQoKTtcbiAgICAgICAgdGhpcy5sb2NhdGVGbGVldCgpO1xuICAgIH07XG5cbiAgICB0aGlzLmNyZWF0ZUdhbWVGaWVsZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgdmFyIHhTaXplID0gdGhpcy5nZXRYKCksXG4gICAgICAgICAgICAgeVNpemUgPSB0aGlzLmdldFkoKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSB4U2l6ZTsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8PSB5U2l6ZTsgaisrKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWVmaWVsZF8nICsgdGhpcy5nZXRSb2xlKCkpLmlubmVySFRNTCArPSAnPHNwYW4gY2xhc3M9XCJzZWFncmlkXCIgaWQ9XCInKyBpICsgJzonKyBqICsgXCJfXCIgKyB0aGlzLmdldFJvbGUoKSsnXCI+PC9zcGFuPic7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRTZWFDb29yZHMoaStcIjpcIitqKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldFJvbGUoKSA9PT0gJ2NvbXAnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRW5lbXlHcmlkcyhpK1wiOlwiK2opO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmxvY2F0ZUZsZWV0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkc2VsZiA9IHRoaXMsXG4gICAgICAgICAgICBmbGVldCA9ICRzZWxmLmdldEZsZWV0KCksXG4gICAgICAgICAgICBrLCBvYmosXG4gICAgICAgICAgICBidXN5Q29vcmRzQXJyYXkgPSBbXTtcblxuICAgICAgICAvLyBydW4gb3ZlciBmbGVldCBvYmplY3RcbiAgICAgICAgZm9yIChrIGluIGZsZWV0KSB7XG4gICAgICAgICAgICBvYmogPSBmbGVldFtrXTtcblxuICAgICAgICAgICAgLy8gcnVuIG92ZXIgc2hpcHMgb24gZmxlZXRcbiAgICAgICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgb2JqLnF1YW50aXR5OyB0KyspIHtcbiAgICAgICAgICAgICAgICB2YXIgc2hpcENvb3JkcyA9IGdlbmVyYXRlQ29vcmRzKCk7IC8vIHJlc3VsdCBjb29yZHMgZm9yIHNoaXBcbiAgICAgICAgICAgICAgICBvYmouY29vcmRzLnB1c2goc2hpcENvb3Jkc1swXSk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBtIGluIHNoaXBDb29yZHNbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyaWdnZXIgPSBidXN5Q29vcmRzQXJyYXkuaW5kZXhPZihzaGlwQ29vcmRzWzFdW21dKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyaWdnZXIgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXN5Q29vcmRzQXJyYXkucHVzaChzaGlwQ29vcmRzWzFdW21dKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNsZWFuU2VhQ29vcmRzKHNoaXBDb29yZHMpO1xuXG4gICAgICAgICAgICAgICAgaWYoJHNlbGYuZ2V0Um9sZSgpID09PSAndXNlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgZHJhd0ZsZWV0KHNoaXBDb29yZHNbMF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGdlbmVyYXRlIGNvb3Jkc1xuICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZUNvb3JkcygpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXSxcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZVBvc2l0aW9uID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgc2hpcCBjb29yZHMgYW5kIGJ1c3kgY29vcmRzXG4gICAgICAgICAgICAgICAgdmFyIGNyZWF0ZWRQb3NpdGlvbiA9IGNyZWF0ZVN0YXJ0UG9zaXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcENvb3JkcyA9IGNyZWF0ZUNvb3JkcyhjcmVhdGVkUG9zaXRpb24pO1xuXG4gICAgICAgICAgICAgICAgLy8gdmFsaWRhdGUgY29vcmRzIGZvciBzaGlwIGxvY2F0aW9uXG4gICAgICAgICAgICAgICAgdmFsaWRhdGVQb3NpdGlvbiA9IGNoZWNrQ29vcmRzKHRlbXBDb29yZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2hpbGUodmFsaWRhdGVQb3NpdGlvbiA9PT0gZmFsc2UpO1xuXG4gICAgICAgICAgICBpZiAodmFsaWRhdGVQb3NpdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRlbXBDb29yZHNbMF0sIHRlbXBDb29yZHNbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJhbmRvbWlzZSBzdGFydCBwb3NpdGlvblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVTdGFydFBvc2l0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpLCAvLyAwIC0gZHJhdyBzaGlwIGhvcml6b250YWw7IDEgLSBkcmF3IHNoaXAgdmVydGljYWxcbiAgICAgICAgICAgICAgICBwb3NJbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgoJHNlbGYuZ2V0U2VhQ29vcmRzKCkubGVuZ3RoLTEpICsgMSkpLCAvLyBhcnJheSBpbmRleFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gJHNlbGYuZ2V0U2VhQ29vcmRzKClbcG9zSW5kZXhdOyAvLyB2YWx1ZSBvbiB0aGlzIGluZGV4XG5cbiAgICAgICAgICAgIHJldHVybiBbcG9zaXRpb24sIGRpcmVjdGlvbl07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjYWxjdWxhdGUgc2hpcCBjb29yZHNcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29vcmRzKHN0YXJ0RGF0YSkge1xuICAgICAgICAgICAgdmFyIHRlbXBTaGlwQ29vcmRzID0gW10sXG4gICAgICAgICAgICAgICAgdGVtcEJ1c3lDb29yZHMgPSBjcmVhdGVCdXN5Q29vcmRzKHN0YXJ0RGF0YSksXG4gICAgICAgICAgICAgICAgc3RhcnRBcnIgPSBzdGFydERhdGFbMF0uc3BsaXQoXCI6XCIpLFxuICAgICAgICAgICAgICAgIHhQb3MgPSBwYXJzZUludChzdGFydEFyclswXSksXG4gICAgICAgICAgICAgICAgeVBvcyA9IHBhcnNlSW50KHN0YXJ0QXJyWzFdKSxcbiAgICAgICAgICAgICAgICBkaXIgPSBzdGFydERhdGFbMV07XG5cbiAgICAgICAgICAgIGZvciAodmFyIHM9MDsgcyA8IG9iai53ZWlnaHQ7IHMrKykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoZGlyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0geFBvcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0geVBvcyArIHM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBTaGlwQ29vcmRzLnB1c2goeCArIFwiOlwiICsgeSk7IC8vIHZhbHVlcyBhcnJheVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0geFBvcyArIHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHlQb3M7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBTaGlwQ29vcmRzLnB1c2goeCArIFwiOlwiICsgeSk7IC8vIHZhbHVlcyBhcnJheVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFt0ZW1wU2hpcENvb3JkcywgdGVtcEJ1c3lDb29yZHNdO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnVzeUNvb3JkcyhpKSB7XG4gICAgICAgICAgICB2YXIgdGVtcERlYWRDb29yZHM9W10sXG4gICAgICAgICAgICAgICAgc3RhcnRBcnIgPSBpWzBdLnNwbGl0KFwiOlwiKSxcbiAgICAgICAgICAgICAgICB4ID0gcGFyc2VJbnQoc3RhcnRBcnJbMF0pLFxuICAgICAgICAgICAgICAgIHkgPSBwYXJzZUludChzdGFydEFyclsxXSksXG4gICAgICAgICAgICAgICAgZGlyID0gaVsxXTsvLyAwIC0gZHJhdyBzaGlwIGhvcml6b250YWw7IDEgLSBkcmF3IHNoaXAgdmVydGljYWxcblxuICAgICAgICAgICAgZm9yICh2YXIgcz0wOyBzIDwgb2JqLndlaWdodDsgcysrKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChkaXIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoeD4xKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKHgtMStcIjpcIisoeStzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih4PDEwKSB0ZW1wRGVhZENvb3Jkcy5wdXNoKHgrMStcIjpcIisoeStzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzPT0wICYmIHg+PTEgJiYgeT4xKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKHgrXCI6XCIrKHktMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHg+MSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEZWFkQ29vcmRzLnB1c2goeC0xK1wiOlwiKyh5LTEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeDwxMCkgdGVtcERlYWRDb29yZHMucHVzaCh4KzErXCI6XCIrKHktMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYocyA9PT0gb2JqLndlaWdodC0xICYmIHk8MTAtcyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERlYWRDb29yZHMucHVzaCh4K1wiOlwiKygoeStzKSsxKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeD4xKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcERlYWRDb29yZHMucHVzaCgoeC0xKStcIjpcIisoKHkrcykrMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih4PDEwKSB0ZW1wRGVhZENvb3Jkcy5wdXNoKCh4KzEpK1wiOlwiKygoeStzKSsxKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih5PjEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEZWFkQ29vcmRzLnB1c2goKHgrcykrXCI6XCIrKHktMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoeTwxMCkgdGVtcERlYWRDb29yZHMucHVzaCgoeCtzKStcIjpcIisoeSsxKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzID09PSAwICYmIHg+MSAmJiB5Pj0xKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wRGVhZENvb3Jkcy5wdXNoKHgtMStcIjpcIisoeSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHk+MSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEZWFkQ29vcmRzLnB1c2goKHgtMSkrXCI6XCIrKHktMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih5PDEwKSB0ZW1wRGVhZENvb3Jkcy5wdXNoKCh4LTEpK1wiOlwiKyh5KzEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHMgPT09IG9iai53ZWlnaHQtMSAmJiB4PDEwLXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEZWFkQ29vcmRzLnB1c2goKHgrcykrMStcIjpcIisoeSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHk+MSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEZWFkQ29vcmRzLnB1c2goKHgrcykrMStcIjpcIisoeS0xKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHk8MTApdGVtcERlYWRDb29yZHMucHVzaCgoeCtzKSsxK1wiOlwiKyh5KzEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0ZW1wRGVhZENvb3JkcztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHZhbGlkYXRvciBmb3IgY3JlYXRlZCBjb29yZHNcbiAgICAgICAgZnVuY3Rpb24gY2hlY2tDb29yZHMoZGF0YSkge1xuICAgICAgICAgICAgdmFyIHZhbGlkYXRvciA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRlc3RTaGlwRG90cyA9IFtdLFxuICAgICAgICAgICAgICAgIHRlc3RCdXN5RG90cyA9IFtdLFxuICAgICAgICAgICAgICAgIHZhbGlkX3NoaXAsXG4gICAgICAgICAgICAgICAgdmFsaWRfYXJvdW5kO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBrIGluIGRhdGFbMF0pIHtcbiAgICAgICAgICAgICAgICB2YXIgY29vcmQgPSAkc2VsZi5nZXRTZWFDb29yZHMoKS5pbmRleE9mKGRhdGFbMF1ba10pLFxuICAgICAgICAgICAgICAgICAgICBidXN5RG90ID0gYnVzeUNvb3Jkc0FycmF5LmluZGV4T2YoZGF0YVswXVtrXSk7IC8vdmFsdWVcblxuICAgICAgICAgICAgICAgIHRlc3RTaGlwRG90cy5wdXNoKGNvb3JkKTtcbiAgICAgICAgICAgICAgICB0ZXN0QnVzeURvdHMucHVzaChidXN5RG90KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGlzX3ZhbGlkID0gZnVuY3Rpb24obikgeyByZXR1cm4gbiA9PSAtMTsgfTtcblxuICAgICAgICAgICAgdmFsaWRfc2hpcCA9IHRlc3RTaGlwRG90cy5zb21lKGlzX3ZhbGlkKTtcbiAgICAgICAgICAgIHZhbGlkX2Fyb3VuZCA9IHRlc3RCdXN5RG90cy5zb21lKGlzX3ZhbGlkKTtcblxuICAgICAgICAgICAgaWYgKHZhbGlkX3NoaXAgPT09IGZhbHNlICYmIHZhbGlkX2Fyb3VuZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHZhbGlkYXRvciA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbGlkYXRvciA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdmFsaWRhdG9yO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZGVsZXRlIGJ1c3kgY29vcmRzIGZyb20gc2VhQ29vcmRzIEFycmF5XG4gICAgICAgIGZ1bmN0aW9uIGNsZWFuU2VhQ29vcmRzKGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBzaGlwQ29vcmRzID0gZGF0YVswXSxcbiAgICAgICAgICAgICAgICBidXN5Q29vcmRzID0gZGF0YVsxXTtcblxuICAgICAgICAgICAgZGVsZXRlcihzaGlwQ29vcmRzLGJ1c3lDb29yZHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlcigpIHtcbiAgICAgICAgICAgIGZvciAodmFyIG0gaW4gYXJndW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayBpbiBhcmd1bWVudHNbbV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3Jkc0FycmF5ID0gJHNlbGYuZ2V0U2VhQ29vcmRzKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBkb3QgPSBjb29yZHNBcnJheS5pbmRleE9mKGFyZ3VtZW50c1ttXVtrXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvdCAhPT0gLTEpICRzZWxmLnJlbW92ZVNlYUNvb3Jkcyhkb3QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGRyYXcgZmxlZXQgb24gc2VhZmllbGRcbiAgICAgICAgZnVuY3Rpb24gZHJhd0ZsZWV0KGkpIHtcblxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZ3JpZElkID0gaVtrZXldK1wiX1wiKyRzZWxmLmdldFJvbGUoKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChncmlkSWQpLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwic2hlZXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufSIsIihmdW5jdGlvbigpe1xuXG4gICAgdmFyIGdhbWUgPSBuZXcgR2FtZSgpO1xuXG4gICAgZ2FtZS5zdGFydEdhbWUoKTtcblxufSgpKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
